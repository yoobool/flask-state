/** @license flask-state
 * flask-state.js
 *
 * Copyright (c) 2020, yoobool
 *
 * This source code is licensed under the BSD-3 license found in the
 * LICENSE file in the root directory of this source tree.
 */

'use strict';



module.exports=function(e){var t={};function s(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(a,i,function(t){return e[t]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";const a=85,i=75,n=10,o=5,l=1048576;class r{constructor(e){this.language=e,this.mobile=r.isMobile(),this.index=0,this.ajax=new d,this.initFlaskStateContainer(this.mobile),this.setEventListener(),this.initFlaskStateLanguage(this.language),this.setInitParams(),this.mobile&&this.setTagChangeEventListener(this.consoleCpuChart,this.consoleMemoryChart,this.consoleLoadavgChart,this.consoleDiskusageChart),window.addEventListener("resize",(()=>{r.resizeChartTimer([this.consoleMemoryChart,this.consoleCpuChart,this.consoleLoadavgChart,this.consoleDiskusageChart])}))}setFlaskStateData(){document.getElementById("fs-info-back").style.display="block",document.getElementById("fs-info-container").style.display="block",document.getElementsByTagName("body")[0].style.overflowX="hidden",document.getElementsByTagName("body")[0].style.overflowY="hidden",document.getElementById("fs-select-days").value="1",this.setCharts("1")}initFlaskStateContainer(){let e='<div class="flask-state-elem layer console-info-back-style" id="fs-info-back" disabled="disabled" xmlns="http://www.w3.org/1999/html"></div><div class="flask-state-elem "><div class="flask-state-elem console-info-container-style console-info-container-box box-style " id="fs-info-container"><div class="flask-state-elem fs-select-container"><svg t="1604570316831" class="icon fs-select-arrow" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3994" width="16" height="16" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"></style></defs><path d="M524.736 548.256l181.248-181.248a51.264 51.264 0 1 1 72.48 72.512l-217.472 217.472a51.264 51.264 0 0 1-72.512 0L271.04 439.52a51.264 51.264 0 1 1 72.512-72.512l181.216 181.248z" fill="#161e2e" p-id="3995"></path></svg><select id="fs-select-days" class="margin-right-5 fs-select-days"><option value="1">1</option><option value="3">3</option><option value="7">7</option><option value="30">30</option></select><span id="fs-days">days</span></div><button type="button" class="flask-state-elem console-info-close-style" id="fs-info-close"><svg t="1604544405227" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3278" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"></style></defs><path d="M572.16 512l183.466667-183.04a42.666667 42.666667 0 1 0-60.586667-60.586667L512 451.84l-183.04-183.466667a42.666667 42.666667 0 0 0-60.586667 60.586667l183.466667 183.04-183.466667 183.04a42.666667 42.666667 0 0 0 0 60.586667 42.666667 42.666667 0 0 0 60.586667 0l183.04-183.466667 183.04 183.466667a42.666667 42.666667 0 0 0 60.586667 0 42.666667 42.666667 0 0 0 0-60.586667z" p-id="3279" fill="#161e2e"></path></svg></button><h4 id="fs-host-status-title" class="flask-state-elem fs-font-box box-style no-padding margin-top-10 fs-h4-style">host status</h4><div id="fs-host-status" class="flask-state-elem fs-font-box box-style no-padding"><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-memory" class="b-0079cc fs-state-right-badge">memory:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-cpu" class="b-0079cc fs-state-right-badge">cpu:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-disk-usage" class="b-0079cc fs-state-right-badge">disk usage:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-load-avg" class="b-007dc8 fs-state-right-badge">LoadAvg:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-boot-seconds" class="b-0051b9 fs-state-right-badge">boot seconds:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div></div><h4 id="fs-redis-status-title" class="flask-state-elem fs-font-box box-style no-padding fs-h4-style">redis status</h4><div id="fs-redis-status" class="flask-state-elem fs-font-box box-style no-padding margin-bottom-10 "><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-used-memory" class="b-99cb3d fs-state-right-badge">used memory:</div><span class="flask-state-elem background-green fs-badge-style margin-top-m3 console-info-memory-text"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-used-memory-rss" class="b-99cb3d fs-state-right-badge">used memory rss:</div><span class="flask-state-elem background-green fs-badge-style margin-top-m3 console-info-memory-text"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-mem-fragmentation-ratio" class="b-534c6d fs-state-right-badge">mem fragmentation ratio:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-hits-ratio" class="b-0079cc fs-state-right-badge">hits ratio:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-delta-hits-ratio" class="b-0079cc fs-state-right-badge">24h hits ratio:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-uptime-in-seconds" class="b-0051b9 fs-state-right-badge">uptime in seconds:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div><div class="inline-block margin-bottom-10 margin-right-18"><div id="fs-connected-clients" class="b-534c6d fs-state-right-badge">connected clients:</div><span class="flask-state-elem fs-badge-style background-green margin-top-m3"></span></div></div>';this.mobile?e+='<hr id="console-info-line" class="console-info-line-style"><div class="flask-state-elem fs-ul-tabs-box no-margin "><ul id="fs-info-tab" class="flask-state-elem fs-ul-tabs"><li class="flask-state-elem active"><a href="#console_info_tab_memory" data-toggle="tab"><strong>memory</strong></a></li><li class="flask-state-elem"><a href="#console_info_tab_cpu" data-toggle="tab"><strong>cpu</strong></a></li><li class="flask-state-elem"><a href="#console_info_tab_diskusage" data-toggle="tab"><strong>disk usage</strong></a></li><li class="flask-state-elem"><a href="#console_info_tab_loadavg" data-toggle="tab"><strong>LoadAvg</strong></a></li></ul><div class="flask-state-elem form-group no-margin "><div class="flask-state-elem state-tab-content "><div id="fs-info-tab-memory" class="flask-state-elem state-tab-pane fs-show"><div class="fs-mobile-chart-container"><div id="fs-info-memory-chart" class="flask-state-elem margin-top-10 fs-chart-style"></div></div></div><div id="fs-info-tab-cpu" class="flask-state-elem state-tab-pane "><div class="fs-mobile-chart-container"><div id="fs-info-cpu-chart" class="flask-state-elem margin-top-10 fs-chart-style"></div></div></div><div id="fs-info-tab-disk-usage" class="flask-state-elem state-tab-pane "><div class="fs-mobile-chart-container"><div id="fs-info-diskusage-chart" class="flask-state-elem margin-top-10 fs-chart-style"></div></div></div><div id="fs-info-tab-loadavg" class="flask-state-elem state-tab-pane"><div class="fs-mobile-chart-container"><div id="fs-info-loadavg-chart" class="flask-state-elem margin-top-10 fs-chart-style"></div></div></div></div></div></div></div></div>':e+="<div class='fs-chart-content'><div class='flask-state-elem fs-charts-box box-style no-padding console-info-border-r'><div class='flask-state-elem charts-box-info'><div id='fs-info-memory-chart' class='flask-state-elem margin-top-10 fs-chart-style'></div></div></div><div class='flask-state-elem fs-charts-box box-style no-padding '><div class='flask-state-elem charts-box-info'><div id='fs-info-cpu-chart' class='flask-state-elem margin-top-10 fs-chart-style'></div></div></div><div class='flask-state-elem fs-charts-box box-style no-padding console-info-border-r '><div class='flask-state-elem charts-box-info'><div id='fs-info-diskusage-chart' class='flask-state-elem margin-top-10 fs-chart-style'></div></div></div><div class='flask-state-elem fs-charts-box box-style no-padding'><div class='flask-state-elem charts-box-info'><div id='fs-info-loadavg-chart' class='flask-state-elem margin-top-10 fs-chart-style'></div></div></div></div></div></div>",document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",e)}setEventListener(){if(window.addEventListener){document.getElementById("fs-info-close").addEventListener("click",(function(){document.getElementById("fs-info-back").style.display="none",document.getElementById("fs-info-container").style.display="none",document.getElementsByTagName("body")[0].style.overflowX="auto",document.getElementsByTagName("body")[0].style.overflowY="auto",document.getElementById("fs-state-circular")&&document.getElementById("fs-state-circular").classList.remove("fs-circular-out")})),document.getElementById("fs-info-back").addEventListener("click",(function(){document.getElementById("fs-info-back").style.display="none",document.getElementById("fs-info-container").style.display="none",document.getElementsByTagName("body")[0].style.overflowX="auto",document.getElementsByTagName("body")[0].style.overflowY="auto",document.getElementById("fs-state-circular")&&document.getElementById("fs-state-circular").classList.remove("fs-circular-out")}));let e=document.getElementById("fs-select-days");e.addEventListener("change",(()=>{this.setCharts(e.value)}))}}setTagChangeEventListener(...e){if(document.getElementById("fs-info-tab")){let t=document.getElementById("fs-info-tab").getElementsByTagName("li"),s=document.getElementById("fs-info-tab-memory"),a=t[0],i=0;const n={0:"fs-info-tab-memory",1:"fs-info-tab-cpu",2:"fs-info-tab-disk-usage",3:"fs-info-tab-loadavg"};for(let o of t){let t=document.getElementById(n[i]);o.children[0].addEventListener("click",(()=>{o.classList.add("active"),a.classList.remove("active"),s.classList.remove("fs-show"),t.classList.add("fs-show"),r.resizeChart(e),s=t,a=o})),i++}}}initFlaskStateLanguage(){0!==Object.keys(this.language).length&&(document.getElementById("fs-host-status-title").innerHTML=this.language.host_status,document.getElementById("fs-redis-status-title").innerHTML=this.language.redis_status,document.getElementById("fs-cpu").innerHTML=this.language.cpu,document.getElementById("fs-memory").innerHTML=this.language.memory,document.getElementById("fs-disk-usage").innerHTML=this.language.disk_usage,document.getElementById("fs-load-avg").innerHTML=this.language.load_avg,document.getElementById("fs-boot-seconds").innerHTML=this.language.boot_seconds,document.getElementById("fs-used-memory").innerHTML=this.language.used_memory,document.getElementById("fs-used-memory-rss").innerHTML=this.language.used_memory_rss,document.getElementById("fs-mem-fragmentation-ratio").innerHTML=this.language.mem_fragmentation_ratio,document.getElementById("fs-hits-ratio").innerHTML=this.language.hits_ratio,document.getElementById("fs-delta-hits-ratio").innerHTML=this.language.delta_hits_ratio,document.getElementById("fs-uptime-in-seconds").innerHTML=this.language.uptime_in_seconds,document.getElementById("fs-connected-clients").innerHTML=this.language.connected_clients,document.getElementById("fs-days").innerHTML=this.language.days)}setInitParams(){this.consoleCpuChart=echarts.init(document.getElementById("fs-info-cpu-chart"),null,{renderer:"svg"}),this.consoleMemoryChart=echarts.init(document.getElementById("fs-info-memory-chart"),null,{renderer:"svg"}),this.consoleLoadavgChart=echarts.init(document.getElementById("fs-info-loadavg-chart"),null,{renderer:"svg"}),this.consoleDiskusageChart=echarts.init(document.getElementById("fs-info-diskusage-chart"),null,{renderer:"svg"}),this.cpuOption=r.generateChatOption(this.mobile,this.language.cpu||"CPU","",this.language.today||"today"),this.memoryOption=r.generateChatOption(this.mobile,this.language.memory||"Memory","",this.language.today||"today"),this.diskUsageOption=r.generateChatOption(this.mobile,this.language.disk_usage||"DiskUsage","",this.language.today||"today"),this.loadavgOption=r.generateChatOption(this.mobile,"Load Avg","loadavg",this.language.minutes||"min")}setCharts(e){this.consoleCpuChart.showLoading(),this.consoleMemoryChart.showLoading(),this.consoleLoadavgChart.showLoading(),this.consoleDiskusageChart.showLoading(),this.ajax.send({type:"POST",url:"/v0/state/hoststatus",data:{timeQuantum:e},success:e=>{const t=["ts","cpu","memory","load_avg","disk_usage"],s=e.data;s.items=s.items.map((e=>{let s={};return t.forEach(((t,a)=>{if("ts"===t)return s[t]=1e3*e[a];s[t]=e[a]})),s}));let d=s.currentStatistic;if(Object.keys(d).length){let e=document.getElementById("fs-host-status").getElementsByClassName("fs-badge-style");e[0].innerHTML=d.memory+"%",e[1].innerHTML=d.cpu+"%",e[2].innerHTML=d.disk_usage+"%",e[3].innerHTML=d.load_avg[0]+"，"+d.load_avg[1]+"，"+d.load_avg[2],e[4].innerHTML=r.getFormatSeconds(d.boot_seconds||0,this.language.days,this.language.hours,this.language.minutes,this.language.seconds);["memory","cpu","disk_usage","load_avg"].forEach((function(t,s){let l="";if("load_avg"===t){let e=(d.load_avg[0]+d.load_avg[1]+d.load_avg[2])/3;l=e>=o?e>=n?"background-red":"background-orange":"background-green"}else l=d[t]>=i?d.memory>=a?"background-red":"background-orange":"background-green";let r=e[s].classList;r.remove("background-green","background-orange","background-red"),r.add(l)}));let t=document.getElementById("fs-redis-status").getElementsByClassName("fs-badge-style"),s=["used_memory","used_memory_rss","mem_fragmentation_ratio","hits_ratio","delta_hits_ratio","uptime_in_seconds","connected_clients"],c=!0;for(let e of s)if(d[e]){c=!1;break}c?(document.getElementById("fs-redis-status-title").innerHTML="",document.getElementById("fs-redis-status-title").style.marginTop="0",document.getElementById("fs-redis-status").style.display="none"):s.forEach(((e,s)=>{switch(e){case"used_memory":case"used_memory_rss":t[s].innerHTML=Math.ceil(d[e]/l)+"M";break;case"mem_fragmentation_ratio":let a=d[e];if(t[s].innerHTML=d[e],null!=a&&a>1){let e=t[s].classList;e.remove("background-green"),e.add("background-red")}break;case"hits_ratio":case"delta_hits_ratio":t[s].innerHTML=d[e]+"%";break;case"uptime_in_seconds":t[s].innerHTML=r.getFormatSeconds(d[e],this.language.days,this.language.hours,this.language.minutes,this.language.seconds);break;case"connected_clients":t[s].innerHTML=d[e]}}))}s.items.reverse();let c=r.getChartsData(s.items),m=c.ts_list,g=c.cpu_list,u=c.memory_list,f=c.load_avg_list[0],h=c.load_avg_list[1],y=c.load_avg_list[2],v=c.disk_usage_list;this.memoryOption.xAxis.data=m,this.cpuOption.xAxis.data=m,this.loadavgOption.xAxis.data=m,this.diskUsageOption.xAxis.data=m,this.memoryOption.series[0].data=u,this.cpuOption.series[0].data=g,this.diskUsageOption.series[0].data=v,this.loadavgOption.series[0].data=f,this.loadavgOption.series[1].data=h,this.loadavgOption.series[2].data=y,this.consoleMemoryChart.setOption(this.memoryOption),this.consoleCpuChart.setOption(this.cpuOption),this.consoleLoadavgChart.setOption(this.loadavgOption),this.consoleDiskusageChart.setOption(this.diskUsageOption),r.resizeChart([this.consoleMemoryChart,this.consoleCpuChart,this.consoleLoadavgChart,this.consoleDiskusageChart])},complete:()=>{this.consoleMemoryChart.hideLoading(),this.consoleCpuChart.hideLoading(),this.consoleLoadavgChart.hideLoading(),this.consoleDiskusageChart.hideLoading()}}).then()}static isMobile(){let e=navigator.userAgent,t={trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1===e.indexOf("KHTML"),mobile:e.match(/AppleWebKit.*Mobile.*/)&&!0,ios:e.match(/\(i[^;]+;( U;)? CPU.Mac OS X/)&&!0,android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1===e.indexOf("Safari"),wechat:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)&&" qq"===e.match(/\sQQ/i)[0]};return t.iPhone||t.iPad||t.webApp||t.wechat||t.qq||t.ios||t.mobile||!1}static resizeChartTimer(e,t){clearTimeout(this.clearId),this.clearId=setTimeout((function(){r.resizeChart(e)}),t||200)}static resizeChart(e){e.forEach((e=>e.resize()))}static generateChatOption(e,t,s="",a=""){let i={color:"loadavg"===s?["#ffa726","#42a5f5","#66bb6a"]:["#42a5f5"],title:{show:!e,text:t},tooltip:{trigger:"axis",formatter:e=>{let t=echarts.format.formatTime("yyyy-MM-dd hh:mm:ss",new Date(parseInt(e[0].axisValue)),!1)+"<br />";for(let a=0;a<e.length;a++)t+=e[a].marker+e[a].seriesName+": "+e[a].value+("loadavg"===s?"":"%")+"<br />";return t}},legend:{data:[a],textStyle:{fontSize:14}},grid:{left:"3%",right:"4%",bottom:"3%",top:e?30:60,containLabel:!0},toolbox:{show:!e,feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,axisLabel:{formatter:function(e){return echarts.format.formatTime("hh:mm",new Date(parseInt(e)),!1)}}},yAxis:{type:"value"},series:[{name:a,type:"line",symbol:"none",hoverAnimation:!1}]};return"loadavg"===s&&(i.legend.data=["1"+a,"5"+a,"15"+a],i.series=[],i.legend.data.forEach((e=>{i.series.push({name:e,type:"line",symbol:"none",hoverAnimation:!1})}))),i}static getChartsData(e){let t=[],s=[],a=[],i=[],n=[],o=[],l=[];for(let r=0;r<e.length;r++){let d=e[r];t.push(d.cpu),s.push(d.disk_usage),a.push(d.load_avg[0]),i.push(d.load_avg[1]),n.push(d.load_avg[2]),o.push(d.memory),l.push(d.ts)}return{cpu_list:t,disk_usage_list:s,load_avg_list:[a,i,n],memory_list:o,ts_list:l}}static getFormatSeconds(e,t="days",s="hours",a="min",i="seconds"){let n=parseInt(e),o=0,l=0,r=0,d="";return n>=60?(o=n/60,o>=60&&(l=o/60,o%=60),l>=24&&(r=l/24,l%=24)):d=n+i,o>0&&(d=Math.floor(o)+a),l>0&&(d=Math.floor(l)+s),r>0&&(d=Math.floor(r)+t),d}}class d{constructor(e){e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.xhr=e}send(e){let t=this.xhr,s={type:e.type||"get",url:e.url||"",async:e.async||!0,data:JSON.stringify(e.data),dataType:e.dataType||"json",contentType:"application/json",success:e.success||null,complete:e.complete||null};return new Promise(((e,a)=>{t.open(s.type,s.url,s.async),t.onreadystatechange=()=>{if(4===t.readyState)if(200===t.status){if("json"===s.dataType){const i=JSON.parse(t.responseText);e(i),null!==s.success?s.success(i):a(new Error(String(t.status)||"No callback function."))}}else a(new Error(String(t.status)||"Server is fail."))},t.onerror=()=>{a(new Error(String(t.status)||"Server is fail."))},t.setRequestHeader("Content-type",s.contentType),t.send(s.data),t.onloadend=()=>{null!=s.complete&&s.complete()}}))}}const c=function(){let e=null;return function(t){return e||(e=new r(t))}}();t.init=function(e){let t=null,s={};if(null!==e&&"object"==typeof e&&(t=e.hasOwnProperty("dom")?e.dom:null,s=e.hasOwnProperty("lang")&&e.lang.hasOwnProperty("language")?e.lang:{}),t instanceof HTMLElement){if(t.getAttribute("flaskState"))return;t.setAttribute("flaskState","true"),t.addEventListener("click",(()=>c(s).setFlaskStateData()))}else{if(document.getElementById("fs-state-circular"))return;let e="<div id='fs-state-circular' class='fs-circular fs-circular-animation' style='border-radius:100px;opacity:0.3;border:2px solid purple;'></div>",t=document.getElementsByTagName("body")[0];t.insertAdjacentHTML("beforeend",e);let a,i,n=document.getElementById("fs-state-circular");n.onclick=function(){this.classList.add("fs-circular-out"),c(s).setFlaskStateData()},n.onmousedown=function(e){i=i||e.clientY,n.classList.remove("fs-circular-animation"),a=setTimeout((function(){n.style.cursor="move",t.style.cursor="move",t.onmousemove=function(e){n.style.top=Math.max(e.clientY-i+300,20)+"px"}}),1500)},t.onmouseup=function(){n.style.cursor="pointer",n.classList.add("fs-circular-animation"),t.onmousemove=null,this.style.cursor="default",clearTimeout(a)},n.ontouchstart=function(e){i=i||e.clientY,n.classList.remove("fs-circular-animation"),a=setTimeout((function(){n.style.cursor="move",t.style.cursor="move",t.ontouchmove=function(e){n.style.top=Math.max(e.clientY-i+300,20)+"px"}}),1500)},t.ontouchend=function(){n.style.cursor="pointer",n.classList.add("fs-circular-animation"),t.ontouchmove=null,this.style.cursor="default",clearTimeout(a)}}}}]);